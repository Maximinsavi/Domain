<script>
(function(){
    console.log("Robot MaxGram complet démarré...");

    // --- CONFIGURATION ---
    const loginUrl = "/index?p=64932261&u=MaxChat"; // page qui sert à login automatique
    const createPostUrl = "/page-creat-post.html";  // page de création
    const posts = [
        { text: "Premier post automatique", image: "" },
        { text: "Deuxième post", image: "https://via.placeholder.com/400" },
        { text: "Troisième post", image: "" }
    ];
    const loginDelayMs = 2000;  // délai pour que la session se crée
    const postDelayMs = 2500;   // délai entre chaque publication

    // --- UTILITAIRES ---
    function sleep(ms){ return new Promise(res => setTimeout(res, ms)); }
    function log(msg){ console.log("[Robot] "+msg); }

    async function runRobot(){
        // 1️⃣ Aller sur login URL pour créer session
        log("Ouverture de l'URL de connexion automatique...");
        window.location.href = loginUrl;
        await sleep(loginDelayMs);

        // 2️⃣ Aller sur page de création
        log("Navigation vers la page de création...");
        window.location.href = createPostUrl;
        await sleep(1500); // attendre chargement

        // 3️⃣ Créer un iframe pour publier chaque post sans perdre la page principale
        let iframe = document.getElementById("robot-frame");
        if(!iframe){
            iframe = document.createElement("iframe");
            iframe.id = "robot-frame";
            iframe.style.width = "0";
            iframe.style.height = "0";
            document.body.appendChild(iframe);
        }

        for(let i=0;i<posts.length;i++){
            const p = posts[i];
            log(`Publication ${i+1}/${posts.length}: "${p.text}"`);

            iframe.src = createPostUrl;

            await new Promise(res=>{
                iframe.onload = async ()=>{
                    const doc = iframe.contentDocument || iframe.contentWindow.document;

                    const textarea = doc.querySelector('textarea[name="text"]');
                    if(textarea) textarea.value = p.text;

                    const imgInput = doc.querySelector('input[name="var-img"]');
                    if(imgInput) imgInput.value = p.image || "";

                    const colorInput = doc.querySelector('input[name="var-color"]');
                    if(colorInput) colorInput.value = "#ffcc00";

                    const postBtn = doc.querySelector('button[name="blog_submit"]');
                    if(postBtn) postBtn.click();

                    log(`Post ${i+1} envoyé.`);
                    await sleep(postDelayMs);
                    res();
                };
            });
        }

        log("Tous les posts ont été envoyés !");
    }

    runRobot();
})();
</script>