<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Robot MaxGram - auto login iframe (u=maximin)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:18px;max-width:1000px;}
  #log{height:200px;border:1px solid #ccc;padding:8px;overflow:auto;background:#fafafa;}
  iframe{width:100%;height:520px;border:1px solid #888;margin-top:12px;}
  .ok{color:#0a8;}
  .err{color:#c33}
  pre{background:#eee;padding:8px;overflow:auto;}
  button{padding:8px 12px;margin-top:8px;cursor:pointer}
</style>
</head>
<body>

<h2>Robot MaxGram ‚Äî auto login dans iframe (u=maximin)</h2>
<div id="log"></div>

<!-- Formulaire de login qui target l'iframe -->
<form id="loginForm" action="//maxgram.wapaxo.com/site_login.html" method="post" target="robotFrame" style="display:none;">
  <input name="user_name_" type="hidden" value="maximin">
  <!-- REMPLACE TON_MOT_DE_PASSE_ICI PAR TON MOT DE PASSE -->
  <input name="password_" id="pwdField" type="hidden" value="TON_MOT_DE_PASSE_ICI">
  <input type="submit" id="loginSubmit" value="login">
</form>

<!-- iframe qui affichera MaxGram -->
<iframe id="robotFrame" name="robotFrame" src="about:blank"></iframe>

<!-- Bouton pour afficher le script √† coller dans la console de l'iframe -->
<button id="showScriptBtn">Afficher script √† coller dans la console de l'iframe</button>

<details style="margin-top:10px;">
  <summary>Script (console) pour ex√©cuter la publication AUTOMATIQUE dans l'iframe</summary>
  <pre id="consoleScript" style="white-space:pre-wrap"></pre>
</details>

<script>
/* ====== CONFIG ====== */
const PROFILE_URL = 'https://maxgram.wapaxo.com/?u=maximin&p=64932261'; // page d'arriv√©e apr√®s login
const CREATE_PAGE = 'https://maxgram.wapaxo.com/page-bot-post.html';    // page de cr√©ation
const WAIT_AFTER_LOGIN_MS = 3000;   // attente apr√®s soumission du login
const WAIT_AFTER_PROFILE_MS = 2500; // attente apr√®s chargement profil
/* ===================== */

const logEl = document.getElementById('log');
function log(msg, cls){
  const d = document.createElement('div');
  if(cls) d.className = cls;
  d.textContent = (new Date()).toLocaleTimeString() + ' ‚Äî ' + msg;
  logEl.appendChild(d);
  logEl.scrollTop = logEl.scrollHeight;
  console.log(msg);
}

// 1) soumettre automatiquement le formulaire dans l'iframe
function autoLoginInIframe(){
  log('Soumission automatique du formulaire de login vers MaxGram (dans l\'iframe)‚Ä¶');
  // 1a : d'abord naviguer l'iframe sur l'URL de login via POST en soumettant le form ciblant l'iframe
  const f = document.getElementById('loginForm');
  // S√©curit√© : s'assurer que l'utilisateur a remplac√© le mot de passe
  const pwd = document.getElementById('pwdField').value;
  if(!pwd || pwd === '64932261'){
    log('‚ö†Ô∏è Remplace "TON_MOT_DE_PASSE_ICI" par ton mot de passe dans le champ hidden avant de lancer.', 'err');
    return;
  }
  // Soumettre dans l'iframe
  f.submit();

  // Apr√®s un d√©lai, forcer l'iframe √† aller vers le profil direct (par pr√©caution)
  setTimeout(()=> {
    try{
      const frame = document.getElementById('robotFrame');
      frame.src = PROFILE_URL;
      log('Chargement du profil : ' + PROFILE_URL);
    }catch(e){
      log('Erreur en naviguant l\'iframe : '+e, 'err');
    }
  }, WAIT_AFTER_LOGIN_MS);
}

// 2) apr√®s que l'iframe ait charg√© le profil, on tentera d'aller sur la page de cr√©ation
const frame = document.getElementById('robotFrame');
frame.addEventListener('load', () => {
  const u = (frame.contentWindow && frame.contentWindow.location && String(frame.contentWindow.location.href)) || frame.src;
  log('Iframe charg√©e ‚Äî URL actuelle: ' + u);
  // Si l'URL contient index.html (ou index?), consid√©rer comme "r√©ussi" et naviguer vers la page de cr√©ation
  try{
    const url = u.toLowerCase();
    if(url.includes('/index') || url.endsWith('/')){
      log('D√©tection : page d\'accueil/profile d√©tect√©e. Navigation vers la page de cr√©ation...', 'ok');
      setTimeout(()=> {
        frame.src = CREATE_PAGE;
        log('Ouverture de la page de cr√©ation : ' + CREATE_PAGE);
      }, WAIT_AFTER_PROFILE_MS);
    } else {
      // si l'iframe est encore sur la page de login, on laisse le flux suivre (ou on retry)
      log('L\'iframe n\'a pas encore redirig√© vers l\'index ‚Äî attendre ou v√©rifier manuellement.');
    }
  }catch(e){
    // Note : l'acc√®s √† frame.contentWindow.location peut lever si cross-origin, mais .src est suffisant.
    log('Note : impossibilit√© de lire exactement l\'URL de l\'iframe (cross-origin). Je m\'appuie sur frame.src.', 'err');
  }
});

// 3) script pr√™t √† coller dans la console de l'iframe pour cr√©er et soumettre les posts
const posts = [
  { text: "Post automatique n¬∞1 üöÄ", image: "" },
  { text: "Post automatique n¬∞2 üñºÔ∏è", image: "https://via.placeholder.com/300" },
  { text: "Post automatique n¬∞3 üéØ", image: "" }
];

const consoleScript = `(function(){
  const posts = ${JSON.stringify(posts, null, 2)};
  const delay = 3000;
  async function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
  async function run(){
    console.log('Script iframe : d√©marrage des publications...');
    // adapter les selecteurs selon le HTML r√©el
    const textarea = document.querySelector('textarea[name="text"]') || document.querySelector('textarea');
    const imgInput = document.querySelector('input[name="var-img"]') || document.querySelector('input[type="text"]');
    const submitBtn = document.querySelector('button[name="blog_submit"]') || document.querySelector('button[type="submit"]') || document.querySelector('input[type="submit"]');

    if(!textarea || !submitBtn){
      console.error('Formulaire introuvable ‚Äî v√©rifie les selecteurs dans le script.');
      return;
    }

    for(let i=0;i<posts.length;i++){
      const p = posts[i];
      console.log('Publication', i+1, '/', posts.length, ':', p.text);
      textarea.value = p.text;
      if(imgInput) imgInput.value = p.image || '';
      // d√©clencher les events d'entr√©e au cas o√π le site √©coute input/change
      textarea.dispatchEvent(new Event('input', {bubbles:true}));
      if(imgInput) imgInput.dispatchEvent(new Event('input', {bubbles:true}));
      // soumettre
      submitBtn.click();
      console.log('Click submit envoy√© pour post', i+1);
      await sleep(delay);
    }
    console.log('‚úÖ Tous les posts envoy√©s (script iframe).');
  }
  run();
})();`;

document.getElementById('consoleScript').textContent = consoleScript;

// bouton pour afficher le script dans la console parent (copie)
document.getElementById('showScriptBtn').addEventListener('click', () => {
  log('Script de publication pr√™t ‚Äî copie-le depuis le panneau ci‚Äëdessous et colle-le dans la console de l\'iframe (F12 ‚Üí Console).', 'ok');
  // mettre le script dans la console du parent aussi (pratique pour copy/paste)
  console.log(consoleScript);
});

// 4) Lancer automatiquement la tentative de login au chargement de la page parente
window.addEventListener('load', ()=> {
  // lancer auto-login
  setTimeout(autoLoginInIframe, 500);
  log('Tentative de login automatique programm√©e (500 ms). Remplace le mot de passe si besoin avant rechargement.');
});
</script>

</body>
</html>