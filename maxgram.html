<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Robot MaxGram Auto</title>
<style>
body{font-family:Arial,sans-serif;max-width:900px;margin:20px auto;padding:10px;}
button{padding:10px;font-size:15px;background:#27ae60;color:#fff;border:none;cursor:pointer;}
iframe{width:100%;height:450px;border:1px solid #ccc;margin-top:20px;}
#status{color:green;font-weight:bold;margin-bottom:10px;}
</style>
</head>
<body>

<h1>Robot MaxGram</h1>
<div id="status">En attente...</div>
<button id="run-btn">D√©marrer le robot</button>

<iframe id="robot-frame" src="about:blank"></iframe>

<script>
const posts = [
  {text:"Post automatique n¬∞1 üöÄ", image:""},
  {text:"Deuxi√®me post automatique avec image üñºÔ∏è", image:"https://via.placeholder.com/300"},
  {text:"Troisi√®me post automatique üéØ", image:""}
];
const delay = 4000; // 4 secondes entre chaque post

function log(msg){
  document.getElementById("status").textContent = msg;
  const iframeDoc = document.getElementById("robot-frame").contentDocument;
  if(iframeDoc){
    const p = iframeDoc.createElement("p");
    p.textContent = msg;
    iframeDoc.body.appendChild(p);
    iframeDoc.body.scrollTop = iframeDoc.body.scrollHeight;
  }
  console.log(msg);
}

function sleep(ms){ return new Promise(res=>setTimeout(res,ms)); }

async function startRobot(){
  log("Ouverture du compte MaxGram...");
  const frame = document.getElementById("robot-frame");
  frame.src = "maxgram.wapaxo.com/?u=maximin&p=64932261";

  await sleep(3000); // Attente que la page d'accueil charge
  log("Connexion d√©tect√©e, ouverture de la page de cr√©ation de post...");

  frame.src = "https://maxgram.wapaxo.com/page-creat-post.html";
  await sleep(4000); // Attente chargement page cr√©ation

  for(let i=0;i<posts.length;i++){
    const p = posts[i];
    log(`Publication ${i+1}/${posts.length}: ${p.text}`);

    // Envoi au contenu interne de l'iframe
    frame.contentWindow.postMessage({type:"createPost", data:p}, "*");
    await sleep(delay);
  }

  log("‚úÖ Tous les posts ont √©t√© envoy√©s !");
}

window.addEventListener("message", (e)=>{
  if(e.data && e.data.type==="log"){
    log(e.data.msg);
  }
});

document.getElementById("run-btn").addEventListener("click", startRobot);
</script>

</body>
</html>