<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Robot MaxGram ‚Äî mono‚Äëcompte (iframe)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:18px;max-width:900px;}
  #log{height:180px;border:1px solid #ccc;padding:8px;overflow:auto;background:#fafafa;margin-bottom:12px;}
  iframe{width:100%;height:520px;border:1px solid #888;margin-top:12px;}
  label{display:block;margin-top:8px}
  input,button{padding:8px;font-size:14px}
  pre{background:#eee;padding:8px;white-space:pre-wrap;}
  .ok{color:#0a8}
  .err{color:#c33}
</style>
</head>
<body>

<h2>Robot MaxGram ‚Äî mono‚Äëcompte</h2>

<div id="log"></div>

<div>
  <label>Nom d'utilisateur (username) :</label>
  <input id="usernameField" type="text" placeholder="ex: Thibaut" value=""/>
  <label>Mot de passe :</label>
  <input id="pwdField" type="password" placeholder="mot de passe" value=""/>
  <div style="margin-top:8px;">
    <button id="saveBtn">Enregistrer et lancer</button>
    <button id="genScriptBtn">Afficher script pour la console (cr√©ation)</button>
  </div>
</div>

<!-- formulaire cach√© qui POSTe dans l'iframe -->
<form id="loginForm" action="//maxgram.wapaxo.com/site_login.html" method="post" target="robotFrame" style="display:none;">
  <input name="user_name_" id="f_user" type="hidden" value="">
  <input name="password_" id="f_pass" type="hidden" value="">
  <input type="submit" id="f_submit" value="login">
</form>

<iframe id="robotFrame" name="robotFrame" src="about:blank"></iframe>

<details style="margin-top:12px;">
  <summary>Script (copiable) ‚Äî coller dans la console de l'iframe pour poster automatiquement</summary>
  <pre id="consoleScript"></pre>
</details>

<script>
/* CONFIG ‚Äî modifie posts si besoin */
const BASE_SITE = 'https://maxgram.wapaxo.com';
const CREATE_PAGE = BASE_SITE + '/page-bot-post.html';
const WAIT_AFTER_LOGIN_MS = 3000;
const WAIT_AFTER_NAV_MS = 2000;

const POSTS = [
  { text: "Post automatique n¬∞1 üöÄ", image: "" },
  { text: "Post automatique n¬∞2 üñºÔ∏è", image: "https://via.placeholder.com/300" },
  { text: "Post automatique n¬∞3 üéØ", image: "" }
];
/* --- */

const logEl = document.getElementById('log');
function log(msg, cls){
  const d = document.createElement('div');
  if(cls) d.className = cls;
  d.textContent = (new Date()).toLocaleTimeString() + ' ‚Äî ' + msg;
  logEl.appendChild(d);
  logEl.scrollTop = logEl.scrollHeight;
  console.log(msg);
}

// fill console script area
function makeConsoleScript(posts, delay=3000){
  return `(function(){
  const posts = ${JSON.stringify(posts, null, 2)};
  const delay = ${delay};
  async function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
  async function run(){
    console.log('‚ñ∂ Script Auto‚ÄëPost : d√©marrage');
    const textarea = document.querySelector('textarea[name="text"]') || document.querySelector('textarea');
    const imgInput = document.querySelector('input[name="var-img"]') || document.querySelector('input[type="text"]');
    const submitBtn = document.querySelector('button[name="blog_submit"]') || document.querySelector('button[type="submit"]') || document.querySelector('input[type="submit"]');
    if(!textarea || !submitBtn){
      console.error('‚ùå Formulaire introuvable. V√©rifie la page de cr√©ation.');
      return;
    }
    for(let i=0;i<posts.length;i++){
      const p = posts[i];
      console.log('‚Üí Publication ' + (i+1) + '/' + posts.length + ':', p.text);
      textarea.value = p.text;
      textarea.dispatchEvent(new Event('input',{bubbles:true}));
      if(imgInput){
        imgInput.value = p.image || '';
        imgInput.dispatchEvent(new Event('input',{bubbles:true}));
      }
      submitBtn.click();
      console.log('Click submit envoy√©');
      await sleep(delay);
    }
    console.log('‚úÖ Tous les posts envoy√©s.');
  }
  run();
})();`;
}

document.getElementById('consoleScript').textContent = makeConsoleScript(POSTS, 3000);

// main actions
const loginForm = document.getElementById('loginForm');
const fUser = document.getElementById('f_user');
const fPass = document.getElementById('f_pass');
const frame = document.getElementById('robotFrame');

function doAutoLogin(username, password){
  if(!username || !password){
    log('‚ö†Ô∏è Username ou password vide ‚Äî impossible de lancer.', 'err');
    return;
  }
  // fill hidden form and submit into iframe (POST)
  fUser.value = username;
  fPass.value = password;
  try{
    loginForm.submit();
    log('Formulaire de login soumis dans l\'iframe pour ' + username);
  }catch(e){
    log('Erreur submit login: '+e, 'err');
    return;
  }
  // after small wait, navigate iframe to base site then to create page
  setTimeout(()=> {
    frame.src = BASE_SITE; 
    log('Iframe navigue vers la page principale du site (sans params).');
    setTimeout(()=>{
      frame.src = CREATE_PAGE;
      log('Iframe navigue vers la page de cr√©ation : ' + CREATE_PAGE);
      // note: pour poster r√©ellement, il faut coller le script ci‚Äëdessous dans la console de l'iframe
    }, WAIT_AFTER_NAV_MS);
  }, WAIT_AFTER_LOGIN_MS);
}

// save + start button
document.getElementById('saveBtn').addEventListener('click', ()=>{
  const u = document.getElementById('usernameField').value.trim();
  const p = document.getElementById('pwdField').value;
  if(!u || !p){ log('Remplis username et mot de passe avant de lancer.', 'err'); return; }
  log('D√©marrage automatique pour '+u);
  doAutoLogin(u,p);
});

// generate script button
document.getElementById('genScriptBtn').addEventListener('click', ()=>{
  const s = document.getElementById('consoleScript').textContent;
  log('Script pour la console affich√© ci‚Äëdessous. Copie et colle dans la console de l\'iframe (F12 ‚Üí s√©lectionner le frame ‚Üí Console).', 'ok');
  console.log(s);
});

// optionally auto-run on page load if inputs prefilled
window.addEventListener('load', ()=>{
  const u = document.getElementById('usernameField').value.trim();
  const p = document.getElementById('pwdField').value;
  // si tu as d√©j√† rempli ces champs dans le HTML, d√©commente la ligne ci‚Äëdessous pour auto‚Äëlancer:
  // if(u && p) doAutoLogin(u,p);
});
</script>
</body>
</html>